name: DeployNewVersion

on:
  push:
    branches:
      - master
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2

    - name: Configure folder to MultiMC
      run: |
        sudo mkdir OnixMC
        sudo mkdir OnixMC/.minecraft
        # sudo rsync -a kubejs OnixMC/.minecraft/
        # sudo rsync -a scripts OnixMC/.minecraft/
        sudo rsync -a mods OnixMC/.minecraft/
        sudo rsync -a config OnixMC/.minecraft/
        sudo rsync -a server-icon.png OnixMC/
        sudo rsync -a instance.cfg OnixMC/
        sudo rsync -a mmc-pack.json OnixMC/

    - name: Create Technic Zip File
      uses: thedoctor0/zip-release@master
      with:
        filename: 'technic.zip'
        exclusions: '*.git* *.github* README.md server-icon.png instance.cfg mmc-pack.json /*OnixMC/*'

    - name: Remove bin Folder
      run: rm -rf bin

    - name: Create MultiMC Zip File
      uses: thedoctor0/zip-release@master
      with:
        filename: 'multimc.zip'
        exclusions: '*.git* *.github* /mods/* /kubejs/* *bin* /bin/** /config/* README.md server-icon.png mmc-pack.json instance.cfg technic.zip'

    - name: List Files
      run: ls

    - name: Upload Technic Release Version
      uses: svenstaro/upload-release-action@v2
      with:
        repo_token: ${{ secrets.TOKEN }}
        file: technic.zip
        asset_name: onixmc_technic.zip
        tag: pack_1
        overwrite: true

    - name: Upload MultiMC Release Version
      uses: svenstaro/upload-release-action@v2
      with:
        repo_token: ${{ secrets.TOKEN }}
        file: multimc.zip
        asset_name: onixmc_multimc.zip
        tag: pack_1
        overwrite: true

    - name: Notify Discord
      uses: rjstone/discord-webhook-notify@v1
      with:
        severity: info
        webhookUrl: ${{ secrets.DISCORD_WEBHOOK }}
        username: OnixMC
        color: '#f78520'
        avatarUrl: 'https://raw.githubusercontent.com/OnixMC/OnixPacks/master/server-icon.png'
        description: Nova vers√£o do modpack disponibilizada.
        # details: 'http://api.technicpack.net/modpack/modpack_name'
